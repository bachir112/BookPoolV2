@using BookPool.DataObjects.DTO
@using BookPool.DataObjects.DTO
@using System;
@using System.Globalization;

@{
    ViewBag.Title = "MyOrders";
    Layout = "~/Views/Shared/_Layout_Out.cshtml";

    List<BookPoolResult> myBooks = new List<BookPoolResult>();
    if (ViewBag.MyBooks != null)
    {
        myBooks = ViewBag.MyBooks as List<BookPoolResult>;
    }
}

<style>
    .tabs .tab a:hover, .tabs .tab a.active {
        border-left:0px;
    }

    .carousel {
        height: 400px !important;
    }

        .carousel .carousel-item {
            width: 100% !important;
        }

        .carousel.carousel-slider .carousel-item {
            overflow: auto;
        }

    .dropdown-content.select-dropdown {
        max-height: 300px;
    }

    #findMyBooksResult ul {
        list-style-type: none;
    }

    #findMyBooksResult li {
        display: inline-block;
    }

    #findMyBooksResult input[type="checkbox"][id^="myCheckbox"] {
        display: none;
    }

    #findMyBooksResult label {
        border: 1px solid #fff;
        padding: 10px;
        display: block;
        position: relative;
        margin: 10px;
        cursor: pointer;
    }

        #findMyBooksResult label:before {
            background-color: white;
            color: white;
            content: " ";
            display: block;
            border-radius: 50%;
            border: 1px solid grey;
            position: absolute;
            top: -5px;
            left: -5px;
            width: 25px;
            height: 25px;
            text-align: center;
            line-height: 28px;
            transition-duration: 0.4s;
            transform: scale(0);
        }

        #findMyBooksResult label img {
            height: 100px !important;
            width: 100px !important;
            transition-duration: 0.2s;
            transform-origin: 50% 50%;
        }

    #findMyBooksResult :checked + label {
        border-color: #ddd;
    }

        #findMyBooksResult :checked + label:before {
            content: "✓";
            background-color: grey;
            transform: scale(1);
        }

        #findMyBooksResult :checked + label img {
            transform: scale(0.9);
            /* box-shadow: 0 0 5px #333; */
            z-index: -1;
        }
</style>

<div id="mainSearchBar" style="background: white; height: 55px; display: none;" class="">
    <div class="row searchBar">
        <div class="col s12 m12 l12">
            <div class="sectionnav">
                <div class="nav-wrapper">
                    <form>
                        <div class="input-field" style="margin-top: 5px; ">
                            <input id="search" type="search" required="" placeholder="What are you browsing for?">
                            <label class="label-icon active" for="search">
                                <i class="material-icons" style="color:var(--primaryGrey) !important">search</i>
                            </label>
                            <i class="material-icons" style="color:var(--primaryGrey) !important">close</i>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

<div id="mainSortByFilter" style="background: white; height: 50px; display: none;" class="">
    <div class="row">
        <div class="col s12 m12 l12 noscroll" style="overflow:auto;">
            <div style="min-width: 800px;">
                <div id="filtersClickableTag" class="card horizontal filterContainerTrigger smallfilter">
                    <div class="card-image" style="padding:0;">
                        <i class="material-icons">filter_list</i>
                    </div>
                    <div class="card-stacked">
                        <div class="card-content" style="padding: 2px 10px;">
                            <p>Filters</p>
                        </div>
                    </div>
                </div>
                <div class="card horizontal smallfilter">
                    <div class="card-stacked">
                        <div class="card-content" style="padding: 2px 10px;">
                            <p>Rating: 4.0+</p>
                        </div>
                    </div>
                </div>
                <div class="card horizontal smallfilter">
                    <div class="card-image" style="padding:0;">
                        <i class="material-icons">motorcycle</i>
                    </div>
                    <div class="card-stacked">
                        <div class="card-content" style="padding: 2px 10px;">
                            <p>Express Delivery</p>
                        </div>
                    </div>
                </div>
                <div class="card horizontal smallfilter filterContainerTrigger">
                    <div class="card-stacked">
                        <div class="card-content" style="padding: 2px 10px;">
                            <p>Sort by</p>
                        </div>
                    </div>
                    <div class="card-image" style="padding:0; float:right;">
                        <i class="material-icons">arrow_drop_down</i>
                    </div>
                </div>
                <div class="card horizontal smallfilter">
                    <div class="card-stacked">
                        <div class="card-content" style="padding: 2px 10px;">
                            <p>Great Offers</p>
                        </div>
                    </div>
                </div>
                <div class="card horizontal smallfilter filterContainerTrigger">
                    <div class="card-stacked">
                        <div class="card-content" style="padding: 2px 10px;">
                            <p>Rating</p>
                        </div>
                    </div>
                    <div class="card-image" style="padding:0; float:right;">
                        <i class="material-icons">arrow_drop_down</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row itemslist container">

    <div class="col s12 m12 l12" style="margin-bottom:30px;">
        <h5 id="sellABookHeader" style="cursor:pointer;" data-IsVisible="True">
            <i class="material-icons left red-text">add_circle_outline</i>
            Sell a book
        </h5>

        <div id="sellABookContainer" style="margin-top:30px;">

            <ul id="sellMyBookTabs" class="tabs">
                <li class="tab col s3" style="padding:0!important;">
                    <a href="#chooseBook" style="padding:0!important;">
                        Book?
                    </a>
                </li>
                <li class="tab col s3" style="padding:0!important;">
                    <a href="#bookInfo" style="padding:0!important;">
                        Info
                    </a>
                </li>
                <li class="tab col s3" style="padding:0!important;">
                    <a href="#pricing" style="padding:0!important;">
                        Pricing
                    </a>
                </li>
            </ul>

            <div class="tabs-wrap">
                <div id="chooseBook" class="col s12" style="padding:20px!important;border:1px solid red;">
                    <input id="findMyBookValue" style="border-bottom:1px solid white!important;" placeholder="Find & Select Your Book" class="input-field" />
                    <div style="float:left;width: 100%;padding-right: 15px;">
                        <a id="findMyBook" class="waves-effect waves-light btn-large pull-right red">
                            <i class="material-icons left">location_searching</i>
                            Find
                        </a>
                    </div>
                    <div id="findMyBooksResult">

                    </div>
                </div>
                <div id="bookInfo" class="col s12" style="padding:20px!important;border:1px solid red;">
                    <div style="float:left;width: 100%;padding-right: 15px;">
                        <select id="bookLanguage">
                            <option>Language</option>
                            <option value="1">English</option>
                            <option value="2">Arabic</option>
                            <option value="3">French</option>
                        </select>
                    </div>
                    <div style="float:left;width: 100%;padding-right: 15px;">
                        <select id="academic">
                            <option value="">Is it a book you used at school or university?</option>
                            <option value="False">Non Academic - Not a university or school book</option>
                            <option value="True">Academic - A university or school book</option>
                        </select>
                    </div>
                    <div style="float:left;width: 100%;padding-right: 15px;">
                        <select id="bookCategory">
                            <option>Category</option>
                            <option value="1">Litterature</option>
                            <option value="2">Engineering</option>
                            <option value="3">Math</option>
                            <option value="4">Sciences</option>
                            <option value="5">Exam Preperation</option>
                            <option value="6">Self-Help</option>
                        </select>
                    </div>
                </div>
                <div id="pricing" class="col s12" style="padding:20px!important;border:1px solid red;">
                    <div style="float:left;width: 100%;padding-right: 15px;">
                        <select id="bookCondition">
                            <option value="">Condition</option>
                            <option value="1">New</option>
                            <option value="2">Good</option>
                            <option value="3">Normal</option>
                            <option value="4">Bad</option>
                        </select>
                    </div>
                    <div style="float:left;width: 100%;padding-right: 15px;">
                        <input id="bookPrice" type="number" style="border-bottom:1px solid #9e9e9e!important;" placeholder="The price you wish to sell it for in Lebanese Pounds" class="input-field" />
                    </div>
                    <div style="float:left;width: 100%;padding-right: 15px;">
                        <a id="createAvailableBook" class="waves-effect waves-light btn-large pull-right red">
                            <i class="material-icons left">add_circle_outline</i>
                            Sell
                        </a>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <div class="col s12 m12 l12" style="margin-top:30px;">
        <h5>
            MY BOOKS - Books i want to sell
            <i class="material-icons" style="color: red;">library_books</i>
        </h5>
        <hr />
    </div>


    @{
        if(myBooks.Count() == 0)
        {
            <h6>
                You still haven't added any book to sell, please add books that you have finished reading.
            </h6>
        }
        foreach (var book in myBooks)
        {
            <div class="col s12 m12 l12">
                @Html.Partial("_MyBook", book)
                <hr />
            </div>
        }
    }

</div>



<script type="text/javascript">

    $(document).ready(function () {
        $('ul.tabs').tabs({
            swipeable: true//,
            //responsiveThreshold: 1920
        });
    });

    $(document).on('click', '#sellABookHeader', function () {
        var showing = $(this).attr('data-IsVisible');
        if (showing == "True") {
            $('#sellABookContainer').fadeOut("slow");
            $(this).attr('data-IsVisible','False');
        } else {
            $('#sellABookContainer').fadeIn("slow");
            $(this).attr('data-IsVisible', 'True');
        }
    });

    $(document).on('change', '.booksCheckbox', function () {
        $(".booksCheckbox").prop('checked', false);
        $(this).prop('checked', true);
    });

    $(document).on('click', '#createAvailableBook', function () {
        var googleID = $('.booksCheckbox:checked').val();
        var bookName = $('.booksCheckbox:checked').attr('data-BookName');
        var price = $('#bookPrice').val();
        var condition = $('#bookCondition').val();
        var category = $('#bookCategory').val();
        var language = $('#bookLanguage').val();
        var academic = $('#academic').val();

        //console.log('googleID = ' + googleID);
        //console.log('bookName = ' + bookName);
        //console.log('price = ' + price);
        //console.log('condition = ' + condition);
        //console.log('category = ' + category);
        //console.log('language = ' + language);
        //console.log('academic = ' + academic);

        $.ajax({
            url: '@Url.Action("SellMyBook","Home")',
            type: 'POST',
            dataType: 'json',
            data: {
                googleID: googleID,
                bookName: bookName,
                price: price,
                condition: condition,
                category: category,
                language: language,
                academic: academic
            },
            success: function (data) {
                location.reload();
            },
            error: function (request, error) {
                location.reload();
            }
        });
    });

    $(document).on('click', '#findMyBook', function () {
        var findMyBookValue = $('#findMyBookValue').val();

        $.ajax({
            url: '@Url.Action("FindMyBook","Home")?query=' + findMyBookValue,
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                console.log('success');
                console.log(data);

                var html = '<ul style="text-align:center;">';
                $.each(data, function (key, value) {
                    console.log(value);
                    console.log(value.Authors);
                    html += '<li>';
                    html += '<input class="booksCheckbox" type="checkbox" id="' + value.GoogleID + '" value="' + value.GoogleID + '" data-BookName="' + value.BookName + '"/>';
                    html += '<label for="' + value.GoogleID + '"><img src="' + value.ImageURL + '" /></label>';
                    //html += '<p>' + value.BookName + '</p>';
                    //html += '<p>By ' + value.Authors + '</p>';
                    html += '</li>';
                });
                html += '</ul>';
                $('#findMyBooksResult').html(html);
            },
            error: function (request, error) {
                console.log('error');
                console.log(error);
            }
        });

    });

</script>